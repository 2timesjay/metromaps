<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="http://d3js.org/d3.v2.js"></script>
  </head>
  <body>
    <script>
//d3.nodes.prefix.gml = "http://graphml.graphdrawing.org/xmlnodes";

String.prototype.trim=function(){return this.replace(/^\s\s*/, '').replace(/\s\s*$/, '');};

var nodetable = {}
var nodes = [];
var links = [];
d3.xml("greek2.graphml", function(doc) {
  var format = d3.time.format("%d/%m/%Y");
  var i = 0;
  // TODO: The first step is to simplify our graph by removing all
  // straight line segments of the graph.  The end result
  // should be a new list of key nodes (nodes with adjacent edge
  // count not equal to two) and edges for all of those nodes, with
  // weight equal to the number of edges that they are representing.
  // For example:
  //   A -- B -- C -- D
  // reduces to:
  //   A -- D  (with edge weight = 3)
  d3.select(doc).selectAll("node").each(function () {
    var e = d3.select(this);
    var id = e.attr("id");
    nodetable[id] = i;
    nodes.push({
      label: e.select("data[key='label']").text().trim(),
      date: format.parse(e.select("data[key='date']").text().trim()),
      sx: parseInt(e.select("data[key='x']").text()),
      sy: parseInt(e.select("data[key='y']").text()),
      index: i,
    });
    i++;
  });
  /*
  d3.select(doc).selectAll("edge").each(function () {
    var e = d3.select(this);
    var n1 = e.attr("source");
    var n2 = e.attr("target");
    links.push({
      source: nodetable[n1],
      target: nodetable[n2]
    })
  });
  */
  run();
});

var margin = {top: 30, right: 200, bottom: 40, left: 50},
    width = 800 - margin.right - margin.left,
    height = 500 - margin.top - margin.bottom;

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.right + margin.left)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("tranodesform", "tranodeslate(" + margin.left + "," + margin.top + ")");

function run() {
  svg.selectAll("circle")
    .data(nodes)
    .enter()
    .append("circle")
    .attr("r", 3)
    .attr("stroke", "#000")
    .attr("stroke-width", 2)
    .attr("cx", function(d) { return d.x; })
    .attr("cy", function(d) { return d.y; });

  var force = d3.layout.force()
      .nodes(nodes)
      .links(links)
      .size([width, height]);

  force.on("tick", function() {
    svg.selectAll("circle")
      .attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });
  });

  force.start();
}
    </script>
  </body>
</html>
